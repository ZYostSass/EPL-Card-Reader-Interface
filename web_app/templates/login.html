<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico')}}" />
  <!-- Bootstrap CSS-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
  <!-- CSS stylesheet-->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/login_styles.css')}}" />
  <!-- Icon stylesheets -->
  <link rel="stylesheet" href="{{ url_for('static',
    filename='fontawesome/css/fontawesome.css')}}" />
  <link rel="stylesheet" href="{{
    url_for('static', filename='fontawesome/css/brands.css')}}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='fontawesome/css/solid.css')}}" />
  <title>EPL Card Reader</title>
</head>

<body>
  <!-- Flash messages -->
  <div class="flash-messages">
    {% with messages = get_flashed_messages(with_categories=True) %} {% if
    messages %} {% for category, message in messages %} {% if category ==
    'error' %}
    <div class="alert alert-danger alert-dismissable fade show d-flex justify-content-between" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% else %}
    <div class="alert alert-success alert-dismissable fade show d-flex justify-content-between" role="alert">
      {{message}}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %} {% endfor %} {% endif %} {% endwith %}
  </div>
  <!-- End Flash messages -->
  <!-- Navigation Bar -->
  <header>
    <div class="logo">
      <i class="fa-solid fa-bolt fa-2xl"></i>
      <h1>EPL Card Reader</h1>
    </div>
    <nav class="navigation">
      <a href="{{ url_for('views.student_checkin') }}" id="checkin">Student Check-in</a>
      <button type="button" class="btn btn-primary login-popup">Login</button>
    </nav>
  </header>
  <!-- End Navigation Bar -->
  <!-- Login -->
  <div role="login" aria-label="Login Form">
    <div class="center">
      <h2>Login</h2>
      <form method="post" action="/login">
        <div class="input-field">
          <i class="fa-solid fa-envelope"></i>
          <input type="text" id="email" name="email" required />
          <span></span>
          <label for="email">Email</label>
        </div>
        <div class="input-field">
          <i class="fa-solid fa-key"></i>
          <input type="password" id="password" name="password" required />
          <span></span>
          <label for="password">Password</label>
        </div>
        <input type="submit" value="Login" />
      </form>
    </div>

    <div id="live_status" style="width: 100px; height: 100px; background-color: red; position: absolute; top: 100px; left: 100px;">
      click for manual card reader check
    </div>
  </div>
  <!-- End Login -->
  <div class="student-checkin-content">
    {% block content %} {% endblock %}
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"
    integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ=="
    crossorigin="anonymous"></script>
  <script>
    $(document).ready(function () {
      $("#live_status").on("click", function(event) {
        event.preventDefault();  // Prevent default link behavior
        fetch("/card_data/")  // Make the request to the card_data route
        .then(response => response.json())  // Parse the JSON response
        .then(data => {
          console.log(data);  // Log the JSON data
        })
        .catch(error => {
          console.log(error);  // Handle any errors
        });
      })

      // Connect to the Socket.IO server.
      // The connection URL has the following format, relative to the current page:
      //     http[s]://<domain>:<port>[/<namespace>]
      var socket = io();

      // Event handler for new connections.
      // The callback function is invoked when a connection with the
      // server is established.
      socket.on('connect', function () {
        $("#live_status").css("background-color", "green");
      });

      socket.on('disconnect', function () {
        $("#live_status").css("background-color", "red");
      });

      // Event handler for server sent data.
      // The callback function is invoked whenever the server emits data
      // to the client. The data is then displayed in the "Received"
      // section of the page.
      socket.on('found_badge', function (msg, cb) {
        alert(msg)
        console.log('Received:' + msg)
        if (cb)
          cb();
      });
    });
  </script>
  <script src="{{url_for('static', filename='script.js')}}"></script>
</body>

</html>