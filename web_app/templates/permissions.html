{% extends "index.html" %} {% block content %}
<div class="permissions-content px-3 pt-4">
  <h2 class="fs-5 pe-2">View Student Equipment Permissions</h2>
  <div class="card-prompt">
    <h3><a href="/card_data/" class="btn btn-primary" id="scan-btn">Scan PSU ID card</a></h3>
    <h4><span>OR</span></h4>
  </div>
  <form action="/permissions/" method="POST" class="badge-form m-5">
    <h3>Enter Manually</h3>
    <div class="mb-3">
      <label for="badge" class="form-label">Badge Number</label>
      <input
        type="text"
        class="form-control"
        name="badge"
        id="badge"
        value="{{ badge }}"
        maxlength="6"
        inputmode="numeric"
        pattern="[0-6]{6}"
        required
      />
      <div id="idHelp" class="form-text">Must be a 6-digit number</div>
    </div>
    <button type="submit" class="btn-primary" id="submit-btn">Submit</button>
  </form>
</div>

<script>
  document.getElementById("scan-btn").addEventListener("click", function(event) {
    event.preventDefault();  // Prevent default link behavior
    fetch("/card_data/")  // Make the request to the card_data route
      .then(response => response.json())  // Parse the JSON response
      .then(data => {
        if (data.card_number) {
          window.location.href = "/permissions/" + data.card_number + "/";  // Redirect to the permissions route with card_number as a parameter
        }
      })
      .catch(error => {
        console.log(error);  // Handle any errors
      });
  });
</script>

{% endblock %}
